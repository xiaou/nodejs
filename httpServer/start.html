<! start.html >

<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type="text/javascript" charset="utf-8"></script>
</head>

<style>
textarea
{
width:80%;
height:90%;
border:0px;
}
pre 
{
white-space: pre-wrap;       /* css-3 */
white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
white-space: -pre-wrap;      /* Opera 4-6 */
white-space: -o-pre-wrap;    /* Opera 7 */
word-wrap: break-word;       /* Internet Explorer 5.5+ */
}
</style>

<body>

<div id="outputDiv"  
style= "width:50%; height:500; border:1px #009000 solid; overflow-y:scroll; overflow-x:hidden ">
<div id="msg"><pre id="outputArea"></pre></div>
<div id="msg_end" style="height:0px; overflow:hidden"></div>
</div>

<div id="inputDiv" style="width:50%; height:100; border:1px #900000 solid;">
<textarea id="inputArea" onkeydown='if(event.keyCode==13){submitButton.click()}'>
</textarea>
<button id="submitButton" >Submit</button>
</div>

<br /><b>log:</b>
<div id="logDiv" style= "width:50%; height:200; overflow-y:scroll; overflow-x:hidden">
<pre id="logArea"></pre>
</div>

<script>
var output = $("#outputArea");
var input = $("#inputArea");
var ws;

function onopen(event)
{
	log("xx come!" + event.data);
}
function onerror(event)
{
	log("error你妹啊: " + event.data);
}
function onmessage(event)
{
	var msg = event.data;
	log("recv:" + msg);
}
function onclose(event)
{
	log("onclose.");
}  

function sendMessage()
{
	output.append(input.val() + "\n");
	scroll2ShowAllDiv("outputDiv");
	
	ws.send(input.val());
}

function log(msg)
{
	var log = $("#logArea");
	log.prepend(msg + "\n");
	document.getElementById('logDiv').scrollTop=0;
}

function scroll2ShowAllDiv(strDivId)
{
	document.getElementById(strDivId).scrollTop=document.getElementById(strDivId).scrollHeight;
}

window.onload = function() 
{	
	if (typeof WebSocket === 'undefined') 
	{
		log("check, error: 你的浏览器不支持WebSocket!");
	}
	else
	{
		log("check, ok: 你的浏览器支持WebSocket!");
		var hostname = location.hostname;
		var port = location.port;
		var url = "ws://" + hostname + ":" + port;
		ws = new WebSocket(url);
		ws.onopen = onopen;
		ws.onerror = onerror;
		ws.onmessage = onmessage; 
		ws.onclose = onclose;
	}

	$("#inputDiv").click(
	function()
	{
		input.focus();
	}
	);

	$("#submitButton").click(
	function()
	{
		sendMessage();
		input.val("");
	}
	);
}

</script>

</body>
</html>

